<!DOCTYPE html>
<html>
<head>
#parse("include.vm")
<title>#springMessage("navbar.calculations") |
	#springMessage("application.name")</title>
</head>
<body>
	<div id="wrapper">
		#parse("header.vm")
		<div id="container">
			<div class="nav_menu">
				<ul>
					<li><a href="#springUrl("/overview")">#springMessage("navbar.overview")</a></li>
					<li><a href="#springUrl("/adjustment")">#springMessage("navbar.adjustment")</a></li>
					<li><a class="active" href="#springUrl("/calculations")">#springMessage("navbar.calculations")</a></li>
					<li><a href="#springUrl("/import/xml")">#springMessage("navbar.import")</a></li>
					<li><a href="#springUrl("/export")">#springMessage("navbar.export")</a></li>
				</ul>
			</div>
			<div id="content">
				<div class="panel_header">
					<h2>#springMessage("navbar.calculations")</h2>
				</div>
				<div id="calculations">
					<div id="my_calculations">
						<h4>#springMessage("calculations.my.calculations")</h4>
						#if ($myCalculations.isEmpty())
						<p>
							<i>#springMessage("calculations.my.calculations.notadded")</i>
						</p>
						#else
						<div class="accordion">
							#foreach ($calculation in $myCalculations)
				
								<h3 class="calculation_${calculation.id}">
									$calculation.name <span class="time" title="$dateTool.format("yyyy-MM-ddHH:mm:ss",$calculation.time.toDate())"> 
										#if ($timeFormatter.periodFromNow($calculation.time, $locale) == "") #springMessage("now") #else $timeFormatter.periodFromNow($calculation.time, $locale) #end</span>
								</h3>
								<div class="accor_content calculation_${calculation.id}">
									<div style="min-height: 100px;">
										<a class="button" href="#springUrl("/adjustment/onepage/${calculation.id}")">EDIT</a>
										<!-- <a class="button delete_button" href="#springUrl("/adjustment/delete/${calculation.id}")">DELETE</a> -->
										<button class="delete_button" data="${calculation.id}">DELETE</button>
										<a class="button" href="#">EXPORT</a>
										<p>$calculation.progress</p>
										#if ($calculation.progress == "not-calculated")
										<button class="calculate_button" data="${calculation.id}">CALCULATE</button>
										#else
										<button class="calculate_button" disabled="disabled" data="${calculation.id}">CALCULATE</button>
										#end

									</div>
								</div>
														
							#end
						</div>
						#end
					</div>
					<div id="shared_calculations">
						<h4>#springMessage("calculations.shared.calculations")</h4>
						#if ($sharedCalculations.isEmpty())
						<p>
							<i>#springMessage("calculations.my.calculations.notadded")</i>
						</p>
						#else
						<div class="accordion">
							#foreach ($calculation in $sharedCalculations)
							<h3>
								$calculation.name <span class="time" title="$dateTool.format("yyyy-MM-ddHH:mm:ss",$calculation.time.toDate())">$timeFormatter.periodFromNow($calculation.time,
									$locale)</span>
							</h3>
							<div class="accor_content">
								<p>Cras dictum. Pellentesque habitant morbi tristique
									senectus et netus et malesuada fames ac turpis egestas.</p>
							</div>
							#end
						</div>
						#end
					</div>
				</div>
				<div id="quick_links">
					<div class="small_panel_header">#springMessage("navbar.adjustment")</div>
					<div class="content">
						<a class="new_button" href="#springUrl("/adjustment")">#springMessage("calculations.adjustment.new")</a>
					</div>
				</div>

			</div>
		</div>
	</div>
	</div>
	#parse("footer.vm")
	<script>
		jQuery(document).ready(function() {

			jQuery("button.delete_button").click(function() {
				var id = jQuery(this).attr("data");
				jQuery.ajax({
					type : "POST",
					data : "id=" + id,
					url : '#springUrl("/calculation/delete")',
					success : function(msg) {
						var object = jQuery(".calculation_" + id);
						object.fadeOut(500, function() {
							jQuery(this).remove();
						});
					}
				});
			});
			
			jQuery("button.calculate_button").click(function() {
				var id = jQuery(this).attr("data");
				var btn = jQuery(this);
				jQuery.ajax({
					type : "POST",
					data : "id=" + id,
					url : '#springUrl("/calculation/calculate")',
					success : function(msg) {
						btn.attr('disabled', 'disabled');
					}
				});
			});

		});
	</script>
</body>
</html>